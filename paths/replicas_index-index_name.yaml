post:
  operationId: replicate_file_by_index
  x-onedata-service: oneprovider
  x-onedata-module: replicate_file
  x-onedata-resource: file
  x-onedata-method: replicate_file_by_index
  summary: Replicate files by index
  tags:
    - Replication
  x-bash-codegen-description: |
    Replicates a files indicated by index to a specified provider. This operation is
    asynchronous as it can take a long time depending on the size of the data
    to move.

    This operation supports also custom index query attributes as provided by
    Couchbase:
      [http://docs.couchbase.com/admin/admin/Views/views-querying.html].

    Additionaly, Couchbase spatial queries:
      [http://docs.couchbase.com/admin/admin/Views/views-geospatial.html] are

    possible using `bbox` query parameter.
    These queries are possible on indexes which emit values conforming to the
    [http://geojson.org/] format.

  description: |
    Replicates a files indicated by index to a specified provider. This operation is
    asynchronous as it can take a long time depending on the size of the data
    to move.

    This operation supports also custom index query attributes as provided by [Couchbase](http://docs.couchbase.com/admin/admin/Views/views-querying.html).

    Additionaly, Couchbase [spatial queries](http://docs.couchbase.com/admin/admin/Views/views-geospatial.html) are possible using `bbox` query parameter.
    These queries are possible on indexes which emit values conforming to the [GeoJSON](http://geojson.org/) format.

    ***Example cURL requests***

    **Replicate file by index within specified space to any provider**
    ```bash
    curl --tlsv1.2 -X POST -H "X-Auth-Token: $TOKEN" \
    "https://$HOST/api/v3/oneprovider/replicas-index/custom_index?space_id=AUISyuidfysidufy8768437yu"


    { "transferId": "4f674576-4c63-443b-b3d5-2f74a40724a0"}
    ```

    **Replicate 100 files from index skipping first 200 to specific storage provider with URL callback**
    ```bash
    curl --tlsv1.2 -X POST -H "X-Auth-Token: $TOKEN" \
    -H 'Content-type: application/json' -d '{ "url": "http://example.com/transfer_complete" }' \
    "https://$HOST/api/v3/oneprovider/replicas-index/custom_index?space_id=AUISyuidfysidufy8768437yu&provider_id=7a0d2c4d-aa00-43df-9e96-cac98b2816bb&skip=200&limit=100"


    { "transferId": "b3c85b99-44db-4277-8c66-2ccd50888565" }
    ```

  produces:
    - application/json
  responses:
    '200':
      description: >
        The replication request was accepted and the result is the transfer ID, which
        can be used for monitoring of the transfer status.
      schema:
        type: object
        properties:
          transferId:
            type: string
            description: Transfer ID.
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
  - name: index_name
    in: path
    description: Name of the index.
    type: string
    required: true
  - name: space_id
    in: query
    description: Space ID in which index exist.
    type: string
    required: true
  - name: provider_id
    in: query
    description: >
      The ID of the provider to which the file should be replicated.
      By default the file will be replicated to the provided handling this REST call.
    required: false
    type: string
  - name: callback
    in: body
    description: >
      This parameter allows the user to specify a REST callback URL, which will be called
      when the transfer is complete
    required: false
    schema:
      $ref: '#/definitions/Callback'
  - name: descending
    in: query
    description: Return the documents in descending by key order.
    type: boolean
    required: false
    default: false
  - name: key
    in: query
    description: >
        Return only documents that match the specified key.
        Key must be specified as a JSON value.
    type: string
    required: false
  - name: limit
    in: query
    description: >
      Limit the number of the returned documents to the specified number.
    type: integer
    required: false
  - name: skip
    in: query
    description: >
      Skip this number of records before starting to return the results.
    type: integer
    required: false
  - name: startkey
    in: query
    description: >
      Return records with a value equal to or greater than the specified key.
      Key must be specified as a JSON value.
    type: string
    required: false
  - name: startkey_docid
    in: query
    description: >
      Return records starting with the specified document ID.
    type: string
    required: false
  - name: endkey
    in: query
    description: >
      Stop returning records when the specified key is reached.
      Key must be specified as a JSON value.
    type: string
    required: false
  - name: endkey_docid
    in: query
    description: >
        Stop returning records when the specified document ID is reached.
    type: string
    required: false
  - name: inclusive_end
    in: query
    description: >
      Specifies whether the specified end key is included in the result.
      ***Note:*** Do not use `inclusive_end` with `key` or `keys`.
    type: boolean
    required: false
    default: false
  - name: stale
    in: query
    description: >
      Allow records from a stale view to be used. Allowed values are `ok`, `update_after` or `false`.
    type: string
    required: false
    default: update_after
    enum:
      - ok
      - update_after
      - "false"
  - name: bbox
    in: query
    description: >
      Specify the bounding box for a spatial query (e.g. ?bbox=-180,-90,0,0)
    type: string
    required: false
  - name: spatial
    in: query
    description: |
      Enable spatial type of query. When querying the file-popularity index, the `start_range` and
      `end_range` constraints should be specified as 6-dimensional arrays, with the following fields:
      `[SizeLowerLimit, LastOpenHoursEpochLowerLimit, TotalOpenLowerLimit, HoursOpenAvgLowerLimit, DayOpenAvgLowerLimit, MonthOpenAvgLowerLimit]`.
    type: boolean
    required: false
  - name: start_range
    in: query
    type: string
    required: false
    description: Array specifying the range in spatial queries (e.g. `start_range=[1,0,0,0,0,0]`).
  - name: end_range
    in: query
    type: string
    required: false
    description: Array specifying the range in spatial queries (e.g. `end_range=[null,null,null,null,null,null]`).
  x-code-samples:
  - lang: Shell
    source: "oneprovider-rest-cli replicateFileByIndex space_id='f209c965-e212-4149-af72-860faea4187a' index_name=name1 key=value1"


delete:
  operationId: delete_replica_by_index
  x-onedata-service: oneprovider
  x-onedata-module: replicate_file
  x-onedata-resource: file
  x-onedata-method: delete_replica_by_index
  summary: Remove existing replicas by index
  tags:
    - Replication
  x-bash-codegen-description: |
    Removes a specific replica of a file. This operation is
    asynchronous as it can take a long time depending on the size of the data
    to move.

    This operation supports also custom index query attributes as provided by
    Couchbase:
      [http://docs.couchbase.com/admin/admin/Views/views-querying.html].

    Additionaly, Couchbase spatial queries:
      [http://docs.couchbase.com/admin/admin/Views/views-geospatial.html] are

    possible using `bbox` query parameter.
    These queries are possible on indexes which emit values conforming to the
    [http://geojson.org/] format.

  description: |
    Removes a specific replica of a file. This operation is
    asynchronous as it can take a long time depending on the size of the data
    to move.

    This operation supports also custom index query attributes as provided by [Couchbase](http://docs.couchbase.com/admin/admin/Views/views-querying.html).

    Additionaly, Couchbase [spatial queries](http://docs.couchbase.com/admin/admin/Views/views-geospatial.html) are possible using `bbox` query parameter.
    These queries are possible on indexes which emit values conforming to the [GeoJSON](http://geojson.org/) format.

    ***Example cURL requests***

    **Removes 100 replicas from index skipping first 200 from specific storage provider**
    ```bash
    curl --tlsv1.2 -X DELETE -H "X-Auth-Token: $TOKEN" -H 'Content-type: application/json' \
    "https://$HOST/api/v3/oneprovider/replicas-index/custom_index?space_id=AUISyuidfysidufy8768437yu&provider_id=7a0d2c4d-aa00-43df-9e96-cac98b2816bb&skip=200&limit=100"


    { "transferId": "b3c85b99-44db-4277-8c66-2ccd50888565" }
    ```

  produces:
    - application/json
  responses:
    '200':
      description: >
        The replication request was accepted and the result is the transfer ID, which
        can be used for monitoring of the transfer status.
      schema:
        type: object
        properties:
          transferId:
            type: string
            description: Transfer ID.
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
  - name: index_name
    in: path
    description: Name of the index.
    type: string
    required: true
  - name: space_id
    in: query
    description: Space ID in which index exist.
    type: string
    required: true
  - name: provider_id
    in: query
    description: >
      The ID of the provider in which the replica should be evicted.
      By default the file will be replicated to the provider handling this REST call.
    required: false
    type: string
  - name: migration_provider_id
    in: query
    description: >
      The ID of the provider to which the replica should be synchronized before replica eviction.
    required: false
    type: string
  - name: descending
    in: query
    description: Return the documents in descending by key order.
    type: boolean
    required: false
    default: false
  - name: key
    in: query
    description: >
        Return only documents that match the specified key.
        Key must be specified as a JSON value.
    type: string
    required: false
  - name: limit
    in: query
    description: >
      Limit the number of the returned documents to the specified number.
    type: integer
    required: false
  - name: skip
    in: query
    description: >
      Skip this number of records before starting to return the results.
    type: integer
    required: false
  - name: startkey
    in: query
    description: >
      Return records with a value equal to or greater than the specified key.
      Key must be specified as a JSON value.
    type: string
    required: false
  - name: startkey_docid
    in: query
    description: >
      Return records starting with the specified document ID.
    type: string
    required: false
  - name: endkey
    in: query
    description: >
      Stop returning records when the specified key is reached.
      Key must be specified as a JSON value.
    type: string
    required: false
  - name: endkey_docid
    in: query
    description: >
        Stop returning records when the specified document ID is reached.
    type: string
    required: false
  - name: inclusive_end
    in: query
    description: >
      Specifies whether the specified end key is included in the result.
      ***Note:*** Do not use `inclusive_end` with `key` or `keys`.
    type: boolean
    required: false
    default: false
  - name: stale
    in: query
    description: >
      Allow records from a stale view to be used. Allowed values are `ok`, `update_after` or `false`.
    type: string
    required: false
    default: update_after
    enum:
      - ok
      - update_after
      - "false"
  - name: bbox
    in: query
    description: >
      Specify the bounding box for a spatial query (e.g. ?bbox=-180,-90,0,0)
    type: string
    required: false
  - name: spatial
    in: query
    description: |
      Enable spatial type of query. When querying the file-popularity index, the `start_range` and
      `end_range` constraints should be specified as 6-dimensional arrays, with the following fields:
      `[SizeLowerLimit, LastOpenHoursEpochLowerLimit, TotalOpenLowerLimit, HoursOpenAvgLowerLimit, DayOpenAvgLowerLimit, MonthOpenAvgLowerLimit]`.
    type: boolean
    required: false
  - name: start_range
    in: query
    type: string
    required: false
    description: Array specifying the range in spatial queries (e.g. `start_range=[1,0,0,0,0,0]`).
  - name: end_range
    in: query
    type: string
    required: false
    description: Array specifying the range in spatial queries (e.g. `end_range=[null,null,null,null,null,null]`).
  x-code-samples:
  - lang: Shell
    source: "oneprovider-rest-cli deleteReplicaByIndex space_id='f209c965-e212-4149-af72-860faea4187a' index_name=name1 key=value1"
