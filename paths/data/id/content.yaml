get:
  operationId: download_file_content
  x-onedata-gri:
    type: op_file
    id: ?OBJECTID_BINDING(id)
    aspect: content
  tags:
    - Basic File Operations
  summary: Download file or directory content
  x-bash-codegen-description: |
    Returns the content of a file or directory specified by [$FILE_ID](#operation/lookup_file_id).

    If $FILE_ID is a regular file, returns its binary content. Partial content
    download is also supported using
    [Range header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range).

    If $FILE_ID is a directory, returns a TAR archive with its contents.
    Any nested files or subdirectories to which the client does not have access
    (e.g. due to insufficient POSIX permissions or ACLs) are omitted in the resulting archive.
    Request for directory download results in redirection URL (in Location hedear) with ID of 
    temporary download session. Download will start after a request to this URL is made. 
    With the use of this URL and range header failed downloads (e.g. after network failure) 
    can be resumed. In such case size (in bytes) of so far downloaded file should be provided 
    as range begin, and range end should be ommited.
  description: |
    Returns the content of a file or directory specified by [$FILE_ID](#operation/lookup_file_id).

    If $FILE_ID is a regular file, returns its binary content. Partial content
    download is also supported using
    [Range header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range).

    If $FILE_ID is a directory, returns a TAR archive with its contents.
    Any nested files or subdirectories to which the client does not have access
    (e.g. due to insufficient POSIX permissions or ACLs) are omitted in the resulting archive.
    Request for directory download results in redirection URL (in Location hedear) with ID of 
    temporary download session. Download will start after a request to this URL is made. 
    With the use of this URL and range header failed downloads (e.g. after network failure) 
    can be resumed. In such case size (in bytes) of so far downloaded file should be provided 
    as range begin, and range end should be ommited.

    ***Example cURL requests***

    **Download entire file content**
    ```bash
    curl -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$FILE_ID/content"

    abcdefghijklmno
    ```

    **Download only part of the file content**
    ```bash
    curl -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$FILE_ID/content" \
    -H "Range: bytes=5-8"

    fghi
    ```

    **Download a directory as tar archive**
    ```bash
    curl -sD - -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$DIR_ID/content" | grep location
    
    location: https://$PROVIDER_HOST/download/$DOWNLOAD_ID
    ```
    
    ```
    curl https://$PROVIDER_HOST/download/$DOWNLOAD_ID > directory.tar
    ```

    **Download a directory as tar archive in single request**
    ```bash
    curl -L -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$DIR_ID/content"
    ```

    **Resume download of a directory (previous download failed after 12345678 bytes)**
    ```bash
    curl -H "Range: bytes=12345678-" https://$PROVIDER_HOST/download/$DOWNLOAD_ID >> directory.tar
    ```

  produces:
    - application/octet-stream
  responses:
    '200':
      description: Entire file content.
      schema:
        type: string
        format: binary
    '206':
      description: Part(s) of file content.
      schema:
        type: string
        format: binary
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: id
      in: path
      description: Id of the file.
      type: string
      required: true
  x-code-samples:
  - lang: Shell
    source: "oneprovider-rest-cli downloadFileContent id=$FILE_ID"


put:
  operationId: update_file_content
  x-onedata-gri:
    type: op_file
    id: ?OBJECTID_BINDING(id)
    aspect: content
  summary: Update file content
  tags:
    - Basic File Operations
  x-bash-codegen-description: |
    Updates content of file specified by [$FILE_ID](#operation/lookup_file_id).
    The `offset` query parameter can be used to start writing from a certain byte
    in the file, in such case the file is NOT truncated (bytes beyond the overwritten
    fragment will be preserved).
    If no `offset` query is given, the file is truncated and the previous file content
    is completely overwritten.

  description: |
    Updates content of file specified by [$FILE_ID](#operation/lookup_file_id).
    The `offset` query parameter can be used to start writing from a certain byte
    in the file, in such case the file is NOT truncated (bytes beyond the overwritten
    fragment will be preserved).
    If no `offset` query is given, the file is truncated and the previous file content
    is completely overwritten.

    ***Example cURL requests***

    **Update file content starting from specified offset:**
    ```bash
    # originally, the file content is  "abcdefghijklmno"

    curl -H "X-Auth-Token: $TOKEN" \
    -X PUT "https://$PROVIDER_HOST/api/v3/oneprovider/data/$FILE_ID/content?offset=4" \
    -H "Content-Type: application/octet-stream" -d "WXYZ"

    # upon success, the file content is "abcdWXYZijklmno"
    ```
  consumes:
    - application/octet-stream
  responses:
    '204':
      description: File content updated successfully.
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: id
      in: path
      description: Id of the file.
      required: true
      type: string
    - name: offset
      in: query
      description: Offset at which data sent as request body should be written to file.
      required: false
      type: integer
      default: 0
    - name: content
      in: body
      description: File content to be written at specified offset.
      required: false
      schema:
        type: string
        format: binary
  x-code-samples:
    - lang: Shell
      source: "cat new_content.txt | oneprovider-rest-cli updateFileContent id=$PARENT_ID -"
