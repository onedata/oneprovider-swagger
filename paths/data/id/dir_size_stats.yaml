get:
  operationId: get_directory_size_stats
  x-onedata-parse_body: as_json_params
  x-onedata-gri:
    type: op_file
    id: ?OBJECTID_BINDING(id)
    aspect: "{dir_size_stats_collection, ?PROVIDER_BINDING}"
  summary: Get directory size statistics.
  tags:
    - Basic File Operations
  x-bash-codegen-description: |
    Retrieves historical size statistics over time for a directory.
    The response includes only the information pertaining to the queried provider;
    in order to collect globally-complete statistics, all providers supporting the
    space must be queried. There may be discrepancies in statistics such as logical
    size of data, which stem from synchronization delays between providers.
    
    Size statistics over time are available only for directories.
    
    **This endpoint requires the size statistics to be enabled for the containing space on the queried provider.**
    
    Two request modes are supported: 
      * `layout` - returns information about the structure of stats collection, i.e. the names of the available time series and metrics within them
      * `slice` - returns a slice of statistics as a collection of slices of requested time series and metrics

  description: |
    Retrieves historical size statistics over time for a directory.
    The response includes only the information pertaining to the queried provider;
    in order to collect globally-complete statistics, all providers supporting the
    space must be queried. There may be discrepancies in statistics such as logical
    size of data, which stem from synchronization delays between providers.
    
    Size statistics over time are available only for directories.
    
    **This endpoint requires the size statistics to be enabled for given space on the queried provider.**
    
    Two request modes are supported: 
      * `layout` - returns information about the structure of stats collection, i.e. the names of the available time series and metrics within them
      * `slice` - returns a slice of statistics as a collection of slices of requested time series and metrics
    
    ***Example cURL requests***
    
    **Get the layout of directory size statistics**    
    ```
    curl -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$DIR_ID/dir_size_stats" \
    -H "Content-Type: application/json" -d '{
        "mode": "layout"  
    }'
    
    {
        "layout": {
            "total_size": [
                "day",
                "hour",
                "minute",
                "month"
            ],
            "storage_use_7ab46e96fdb27a2694493c2c5bd7491dch8f55": [...],
            "reg_file_and_link_count": [...],
            "file_errors_count": [...],
            "dir_errors_count": [...],
            "dir_count": [...]
        }
    }
    ```
    
    **Get a slice of directory size statistics**    
    ```bash
    curl -H "X-Auth-Token: $TOKEN" \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$DIR_ID/dir_size_stats" \
    -H "Content-Type: application/json" -d '{
        "mode": "slice",
        "extendedInfo": true,
        "layout": {
            "total_size": [
                "minute"
            ],
            "storage_use_7ab46e96fdb27a2694493c2c5bd7491dch8f55": [
                "minute"
            ]
        },
        "startTimestamp": 1687513285,
        "windowLimit": 31
    }'
    
    {
        "slice": {
            "total_size": {
                "minute": [
                    {
                        "value": 883365,
                        "timestamp": 1687513260,
                        "lastMeasurementTimestamp": 1687513287,
                        "firstMeasurementTimestamp": 1687513287
                    },
                    ...
                ]
            },
            "storage_use_7ab46e96fdb27a2694493c2c5bd7491dch8f55": {
                "minute": [
                    {
                        "value": 56280,
                        "timestamp": 1687513260,
                        "lastMeasurementTimestamp": 1687513287,
                        "firstMeasurementTimestamp": 1687513287
                    },
                    ...
                ]
            }
        }
    }'
    ```
  consumes:
    - application/json
  produces:
    - application/json
  responses:
    '200':
      description: Response to the directory size statistics query.
      schema:
        $ref: '#/definitions/DirSizeStatsResponse'
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: id
      in: path
      description: | 
        Directory Id
      type: string
      required: true
    - name: data
      in: body
      description: Query body.
      required: true
      schema:
        $ref: '#/definitions/DirSizeStatsQuery'
  x-code-samples:
    - lang: Shell
      source: "oneprovider-rest-cli getSizeStats id=$DIR_ID"
