get:
  operationId: list_files_recursively
  x-onedata-parse_body: as_json_params
  x-onedata-gri:
    type: op_file
    id: ?OBJECTID_BINDING(id)
    aspect: files
  tags:
    - Basic File Operations
  summary: List files recursively
  x-bash-codegen-description: |
    Recursively lists non-directory files (i.e regular files, symbolic links and hardlinks)
    in directory specified by [$DIR_ID](#operation/lookup_file_id) (listing root).
    Files are listed in lexicographical order by their paths, which are relative to the listing root directory.
    If there is no access to specified directory, its own relative path (`"."`) will be included in the
    `inaccessiblePaths` field and the listing result (i.e. `files` field) will be empty.
    
    **NOTE**: as of version 21.02.4, some of the attributes have been renamed and the list of available ones have been extended.
    The old attribute names are **DEPRECATED** and scheduled for deletion in future releases. For now, they are still accepted in
    the APIs and returned if the client makes a request specifying their old names. The following changes were introduced:
    * `file_id` -> `fileId`
    * `mode` -> `posixPermissions`
    * `parent_id` -> `parentFileId`
    * `storage_group_id` -> `displayGid`
    * `storage_user_id` -> `displayUid`
    * `is_fully_replicated` -> `isFullyReplicatedLocally`
    * `provider_id` -> `originProviderId`
    * `shares` -> `directShareIds`
    * `owner_id` -> `ownerUserId`
    * `hardlinks_count` -> `hardlinkCount`

  description: |
    Recursively lists non-directory files (i.e regular files, symbolic links and hardlinks)
    in directory specified by [$DIR_ID](#operation/lookup_file_id) (listing root).
    Files are listed in lexicographical order by their paths, which are relative to the listing root directory.
    If there is no access to specified directory, its own relative path (`"."`) will be included in the
    `inaccessiblePaths` field and the listing result (i.e. `files` field) will be empty.
    
    **NOTE**: as of version 21.02.4, some of the attributes have been renamed and the list of available ones have been extended.
    The old attribute names are **DEPRECATED** and scheduled for deletion in future releases. For now, they are still accepted in
    the APIs and returned if the client makes a request specifying their old names. The following changes were introduced:
    * `file_id` -> `fileId`
    * `mode` -> `posixPermissions`
    * `parent_id` -> `parentFileId`
    * `storage_group_id` -> `displayGid`
    * `storage_user_id` -> `displayUid`
    * `is_fully_replicated` -> `isFullyReplicatedLocally`
    * `provider_id` -> `originProviderId`
    * `shares` -> `directShareIds`
    * `owner_id` -> `ownerUserId`
    * `hardlinks_count` -> `hardlinkCount`

    ***Example cURL requests***

    **List files recursively**
    ```bash
    curl -H "X-Auth-Token: $TOKEN" -H 'Content-type: application/json' \
    -X GET "https://$PROVIDER_HOST/api/v3/oneprovider/data/$DIR_ID/files" -d '{
      "start_after": "ParentDirName/Dir1",
      "attributes": ["fileId", "path"]
    }'

    {
        "files": [
            {
                "fileId": "FILE_ID1",
                "path": "ParentDirName/Dir2"
            },
            {
                "fileId": "FILE_ID2",
                "path": "ParentDirName/File1.txt"
            },
        ],
        "inaccessiblePaths": [
            "ParentDirName/Dir3"
        ],
        "isLast": false,
        "nextPageToken": "$PAGING_TOKEN"
    }
    ```
  produces:
    - application/json
  responses:
    '200':
      description: The list of directory files and subdirectories.
      schema:
        $ref: '#/definitions/RecursiveFileList'
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: Invalid path - file or directory not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: id
      in: path
      description: Id of the directory to be listed.
      type: string
      required: true

    - name: data
      in: body
      required: false
      schema:
        $ref: '#/definitions/GetRecursiveFileListRequest'

    - name: attribute
      in: query
      required: false
      description: >
        (**DEPRECATED**) Name of the attribute to be included in the results for each listed file. 
        Can be provided multiple times. 
        This parameter is still supported but scheduled for deletion in future releases.
        Use `attributes` instead.
      type: string
      enum:
        - name
        - path
        - owner_id
        - type
        - mode
        - size
        - atime
        - mtime
        - ctime
        - storage_group_id
        - storage_user_id
        - shares
        - provider_id
        - file_id
        - parent_id
        - hardlinks_count
        - index
        - xattr.*
  x-code-samples:
  - lang: Shell
    source: "oneprovider-rest-cli listFilesRecursively id=$FILE_ID limit=100 start_after=dir1/dir2/filename.txt"