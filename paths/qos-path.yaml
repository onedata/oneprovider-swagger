get:
  operationId: get_effective_qos
  x-onedata-gri:
    type: op_qos
    id: ?PATH_BINDING
    aspect: effective_qos
  tags:
    - QoS
  summary: Get QoS summary (by path)
  x-bash-codegen-description: |
    Returns QoS summary for file or directory specified by path. QoS summary
    contains information about effective QoS, which is calculated by merging
    QoS entries defined directly for file with QoS entries defined for all
    its parents. Effective QoS contains list of all QoS entries that influences
    given file or directory and mapping that maps storage ID to sublist of QoS
    entries. This mapping shows which QoS entries requires file replica on given
    storage (mapping is calculated by system using information stored in QoS entries).
  description: |
    Returns QoS summary for file or directory specified by path. QoS summary
    contains information about effective QoS, which is calculated by merging
    QoS entries defined directly for file with QoS entries defined for all
    its parents. Effective QoS contains list of all QoS entries that influences
    given file or directory and mapping that maps storage ID to sublist of QoS
    entries. This mapping shows which QoS entries requires file replica on given
    storage (mapping is calculated by system using information stored in QoS entries).

    ***Example cURL requests***

    **Get effective QoS for file specified by path**
    ```bash
    curl --tlsv1.2 -X GET -H "X-Auth-Token: $TOKEN" \
    "https://$HOST/api/v3/oneprovider/qos/MySpace1/Folder2"

    {
      "assignedEntries": {"6969ba86d2172e15f8156ccb32a58b92": ["fc05cfc92eda7a054b835bc1ee4a1372"]},
      "qosList": ["fc05cfc92eda7a054b835bc1ee4a1372"],
      "fulfilled": false
    }
    ```
  produces:
    - application/json
  responses:
    '200':
      description: Effective QoS for file or directory.
      schema:
        $ref: '#/definitions/EffectiveQos'
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: path
      in: path
      description: >
        Full path to the file, starting with space name (e.g. '/MySpace1/Folder2').
      type: string
      required: true
  x-code-samples:
    - lang: Shell
      source: "oneprovider-rest-cli getEffectiveQos path='/MySpace1/Folder2'"


post:
  operationId: add_qos_entry
  x-onedata-parse_body: as_json_params
  x-onedata-gri:
    type: op_qos
    id: ?PATH_BINDING
    aspect: instance
  summary: Add QoS entry (by path)
  tags:
    - QoS
  x-bash-codegen-description: |
    Adds new QoS entry for file or directory specified by path. This triggers
    data replication (in needed) based on requirements defined in new QoS entry.
  description: |
    Adds new QoS entry for file or directory specified by path. This triggers
    data replication (in needed) based on requirements defined in new QoS entry.

    ***Example cURL requests***

    **Add QoS entry for file specified by path**
    ```bash
    curl --tlsv1.2 -H "X-Auth-Token: $TOKEN" -X POST \
    -H "Content-type: application/json" \
    -d '{ "expression": "country=FR", "replicasNum": 2 }' \
    "https://$HOST/api/v3/oneprovider/qos/MySpace1/Folder2"

    {"qosId": "fc05cfc92eda7a054b835bc1ee4a1372"}
    ```
  consumes:
    - application/json
  responses:
    '200':
      description: Id of added QoS entry (e.g. 'fc05cfc92eda7a054b835bc1ee4a1372')
      schema:
        type: string
    '400':
      description: Invalid request.
      schema:
        $ref: '#/definitions/Error'
    '403':
      description: Forbidden request.
      schema:
        $ref: '#/definitions/Error'
    '404':
      description: File not found.
      schema:
        $ref: '#/definitions/Error'
    '500':
      description: Internal server error.
      schema:
        $ref: '#/definitions/Error'
  parameters:
    - name: path
      in: path
      description: >
        Full path to the file, starting with space name (e.g. '/MySpace1/Folder2').
        QoS entry can be also added for whole space (e.g. '/MySpace1').
      type: string
      required: true
    - name: data
      in: body
      description: Data containig expression and required replicas number.
      schema:
        $ref: '#/definitions/QosReq'
      required: true
  x-code-samples:
    - lang: Shell
      source: "oneprovider-rest-cli addQosEntry path='/MySpace1/Folder2' expression='country=FR' replicasNum=2"
